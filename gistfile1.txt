#!/bin/bash


SSID="Deriv WiFi"


iwgetid | awk -F ESSID: '{print $2}' | grep -oP '(?<=").*(?=")' > /current.ssid

currentssid=$(cat /current.ssid)


#making a function which will be called if  user is  not connected to a company's routeer
###################################################################################################################################################

ufw_action()
{
ufw reset
#allowing access from Microtik
ufw allow out from 192.168.60.242 &&

#denying access from any ip that doesn't match Mikrotik router IP address.
ifconfig | grep inet | awk '{ print $2}' | egrep -v '([a-z]|^127|192.168.60|^::)' | xargs ufw deny out from  2>/dev/null  &&
#for i in $(ifconfig | grep inet | awk '{ print $2}' | egrep -v '([a-z]|^127|192.168.60|^::)') ; do ufw deny out from $i; done  #the same as above

ufw enable
}
#######################################################################################################################################################


if [[ $currentssid == $SSID ]] ; then echo "ssid is correct">>/tmp/connections.log ; else ufw_action ; fi
